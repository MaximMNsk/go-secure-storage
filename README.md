# Secure Storage

## Работа с ключевой информацией
Состав системы шифрования:
* Мастер-ключ сервера
* Пароль клиента и его производные:
    * Хэш пароля
    * Ключ клиента

Мастер ключ сервера состоит из 2-х компонент. 
Компоненты хранятся у двух офицеров безопасности.
При запуске системы вводятся эти компоненты. Из них складывается мастер-ключ.
Мастер-ключ не хранится нигде в чистом виде.
Для работы с мастер-ключом генерируется сессионный ключ (можно хранить в БД), сессионным ключом шифруется мастер-ключ.
Шифрованный мастер-ключ хранится в памяти в момент работы сервера. Необходим только для генерации ключей клиента при регистрации или смене пароля.
Мастер-ключ является основным ключом шифрования данных в базе.
Не зная мастер-ключа расшифровать данные из базы невозможно.
При компрометации всех данных в БД безопасность данных сохраняется.

Пароль клиента необходим для генерации ключа клиента. 
Ключ клиента получается при шифровании мастер-ключа сервера хэшем пароля клиента.
Шифрование данных клиента происходит по следующему алгоритму:
1. Получаем пароль клиента в чистом виде.
2. Рассчитываем от него хэш.
3. Расшифровываем мастер-ключ сервера.
4. Расшифровываем данные клиента из-под мастер-ключа.
5. Отдаем данные клиенту.

При хранении хэша пароля для авторизации используются 16 символов хэша, при работе с ключом клиента - 32 символа.
Хэш пароля для расшифровки мастер ключа хранится в памяти сервера в момент работы ПО.
При подозрении на компрометацию ключей клиента достаточно сменить пароль. При этом нет необходимости перешифровывать данные клиента.

## TODO or not TODO
* Механизм смены мастер ключа.
* Механизм смены пароля пользователя.
* Шифрование данных клиента посредством мастер-ключа клиента. Обеспечение дополнительной безопасности данных при передаче на сервер.
* Шифрование файловых ресурсов.
* Фрагментирование больших файлов при передаче на сервер.
* Докачка файлов.
* Перенос временной информации о пользователе из памяти в кэш.
* Асинхронная работа с minio через кролика или кафку + вебхуки для клиента. 
* Кидать в логи разврапленные ошибки.